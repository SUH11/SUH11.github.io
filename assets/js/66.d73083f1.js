(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{415:function(v,a,t){"use strict";t.r(a);var _=t(42),e=Object(_.a)({},(function(){var v=this,a=v.$createElement,t=v._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"http的缓存代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http的缓存代理"}},[v._v("#")]),v._v(" HTTP的缓存代理")]),v._v(" "),t("p",[v._v("缓存代理：可以让请求不必走完整个后续处理流程，“就近”获得响应结果。")]),v._v(" "),t("p",[v._v("​\t\t\t\t\tHTTP 的服务器缓存功能主要由代理服务器来实现（即缓存代理）")]),v._v(" "),t("ol",[t("li",[t("h4",{attrs:{id:"缓存代理服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存代理服务"}},[v._v("#")]),v._v(" 缓存代理服务")]),v._v(" "),t("p",[v._v("代理收到源服务的数据做的两件事：")]),v._v(" "),t("p",[v._v("​\t第一，把报文转发给客户端。")]),v._v(" "),t("p",[v._v("​\t第二，把报文存入自己的Cache里。")]),v._v(" "),t("p",[t("em",[v._v("代理“既是客户端，又是服务器”，同时也“既不是客户端，又不是服务器”")])])]),v._v(" "),t("li",[t("h4",{attrs:{id:"源服务器的缓存控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#源服务器的缓存控制"}},[v._v("#")]),v._v(" 源服务器的缓存控制")]),v._v(" "),t("ul",[t("li",[v._v("max-age")]),v._v(" "),t("li",[v._v("no-store")]),v._v(" "),t("li",[v._v("no-cache")]),v._v(" "),t("li",[v._v("must-revalidate")])]),v._v(" "),t("p",[v._v("这四种属性可以约束客户端，也可以约束代理。")]),v._v(" "),t("p",[v._v("如何区分：")]),v._v(" "),t("ul",[t("li",[v._v("private：缓存只能在客户端保存")]),v._v(" "),t("li",[v._v("public：缓存完全开放，谁都可以存，谁都可以用")])]),v._v(" "),t("p",[v._v("缓存失效校验：（要有Last-modified和ETag）")]),v._v(" "),t("ul",[t("li",[v._v("must-revalidate：只要过期必须回源服务器验证")]),v._v(" "),t("li",[v._v("proxy-revalidate：代理的缓存过期后必须验证，客户端不必回源，只需验证到代理这个环节")]),v._v(" "),t("li",[v._v("s-maxage：在代理上能存多久")]),v._v(" "),t("li",[v._v("max-age：客户端还是用这个字段")]),v._v(" "),t("li",[v._v("no-transform：禁止处理（例如对数据做优化）")])]),v._v(" "),t("blockquote",[t("p",[v._v("⚠️源服务器在设置完“Cache-Control”后必须要为报文加上“Last-modified”或“ETag”字段。")]),v._v(" "),t("p",[v._v("否则，客户端和代理后面就无法使用条件请求来验证缓存是否有效，也就不会有 304 缓存重定向。")])])]),v._v(" "),t("li",[t("h4",{attrs:{id:"客户端的缓存控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端的缓存控制"}},[v._v("#")]),v._v(" 客户端的缓存控制")]),v._v(" "),t("ul",[t("li",[v._v("no-store")]),v._v(" "),t("li",[v._v("only-if-cached")]),v._v(" "),t("li",[v._v("no-cache")]),v._v(" "),t("li",[v._v("max-age")]),v._v(" "),t("li",[v._v("max-stale：代理上的缓存过期了也可以接受，但不能过期太多，超过 x 秒也会不要")]),v._v(" "),t("li",[v._v("min-fresh：绝对不允许过期，还有min-fresh=x，x秒之后还是有效的")]),v._v(" "),t("li",[v._v("no-transform")])])]),v._v(" "),t("li",[t("h4",{attrs:{id:"其他问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他问题"}},[v._v("#")]),v._v(" 其他问题")]),v._v(" "),t("ul",[t("li",[t("p",[v._v("X-Cache：缓存是否命中")])]),v._v(" "),t("li",[t("p",[v._v("X-Hit：命中率")])]),v._v(" "),t("li",[t("p",[v._v("X-Accel：自定义字段，被谁加速")])]),v._v(" "),t("li",[t("p",[t("strong",[v._v("Vary字段")])]),v._v(" "),t("blockquote",[t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 内容协商后，会有不同的字符集、编码、浏览器版本等")]),v._v("\nVary: Accept-Encoding\nVary: User-Agent\n")])]),v._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[v._v("1")]),t("br"),t("span",{staticClass:"line-number"},[v._v("2")]),t("br"),t("span",{staticClass:"line-number"},[v._v("3")]),t("br")])])])]),v._v(" "),t("li",[t("p",[t("strong",[v._v("Puarge")]),v._v("清理缓存")]),v._v(" "),t("blockquote",[t("p",[v._v("什么时候要清理？")]),v._v(" "),t("ol",[t("li",[v._v("过期的数据应该及时淘汰，避免占用空间；")]),v._v(" "),t("li",[v._v("源站的资源有更新，需要删除旧版本，主动换成最新版（即刷新）；")]),v._v(" "),t("li",[v._v("有时候会缓存了一些本不该存储的信息，例如网络谣言或者危险链接，必须尽快把它们删除。")])])])])])])]),v._v(" "),t("p",[v._v("如何学习nginx: 只要理解的http的缓存代理，nginx的是比较容易掌握的，可以结合nginx的文档，看proxy相关的指令，逐条对照http的功能。")]),v._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),t("ol",[t("li",[v._v("计算机领域里最常用的性能优化手段是“时空转换”，也就是“时间换空间”或者“空间换时间”，HTTP 缓存属于后者；")]),v._v(" "),t("li",[v._v("缓存代理是增加了缓存功能的代理服务，缓存源服务器的数据，分发给下游的客户端；")]),v._v(" "),t("li",[v._v("“Cache-Control”字段也可以控制缓存代理，常用的有“private”“s-maxage”“no-transform”等，同样必须配合“Last-modified”“ETag”等字段才能使用；")]),v._v(" "),t("li",[v._v("缓存代理有时候也会带来负面影响，缓存不良数据，需要及时刷新或删除。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);