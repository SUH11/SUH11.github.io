(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{407:function(t,n,a){"use strict";a.r(n);var s=a(42),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"http传输大文件的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http传输大文件的方法"}},[t._v("#")]),t._v(" HTTP传输大文件的方法")]),t._v(" "),a("ol",[a("li",[a("h4",{attrs:{id:"数据压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据压缩"}},[t._v("#")]),t._v(" 数据压缩")]),t._v(" "),a("p",[t._v("Accept-Encoding")]),t._v(" "),a("p",[t._v("Content-Encoding")])])]),t._v(" "),a("blockquote",[a("p",[t._v("gzip 等压缩算法通常只对文本文件有较好的压缩率，而图片、音频视频等多媒体数据本身就已经是高度压缩的，再用 gzip 处理也不会变小（甚至还有可能会增大一点），所以它就失效了。")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("h4",{attrs:{id:"分块传输"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分块传输"}},[t._v("#")]),t._v(" 分块传输")]),t._v(" "),a("p",[t._v("Transfer-Encoding: chunked")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"image-20200622104747418",href:"/Users/su/Library/Application Support/typora-user-images/image-20200622104747418.png"}},[t._v("![image-20200622104747418](/Users/su/Library/Application Support/typora-user-images/image-20200622104747418.png)")])])]),t._v(" "),a("li",[a("h4",{attrs:{id:"范围请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范围请求"}},[t._v("#")]),t._v(" 范围请求")]),t._v(" "),a("p",[t._v("允许客户端在请求头里使用专用字段来表示只获取文件的一部分，相当于是客户端的“化整为零”")]),t._v(" "),a("p",[t._v("服务器：Accept-Ranges: bytes")]),t._v(" "),a("p",[a("code",[t._v("Range")]),t._v(" 的格式也很灵活，起点 x 和终点 y 可以省略，能够很方便地表示正数或者倒数的范围。假设文件是 100 个字节，那么：")]),t._v(" "),a("ul",[a("li",[t._v("“0-”表示从文档起点到文档终点，相当于“0-99”，即整个文件；")]),t._v(" "),a("li",[t._v("“10-”是从第 10 个字节开始到文档末尾，相当于“10-99”；")]),t._v(" "),a("li",[t._v("“-1”是文档的最后一个字节，相当于“99-99”；")]),t._v(" "),a("li",[t._v("“-10”是从文档末尾倒数 10 个字节，相当于“90-99”。")])]),t._v(" "),a("p",[t._v("服务器收到 "),a("code",[t._v("Range")]),t._v(" 字段后，需要做四件事")]),t._v(" "),a("p",[t._v("​\t第一，它必须检查范围是否合法，不合法：416")]),t._v(" "),a("p",[t._v("​\t第二，如果范围正确，206 Partial Content (相当于200)")]),t._v(" "),a("p",[t._v("​\t第三，服务器要添加响应字段：Content-Range")]),t._v(" "),a("p",[t._v("​\t第四，发送数据")])])]),t._v(" "),a("p",[t._v("例子：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// 请求\nGET /16-2 HTTP/1.1\nHost: www.chrono.com\nRange: bytes=0-31\n\n// 返回\nHTTP/1.1 206 Partial Content\nContent-Length: 32\nAccept-Ranges: bytes\nContent-Range: bytes 0-31/96\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("注：")]),t._v(" "),a("p",[t._v("看视频的拖拽进度需要范围请求，常用的下载工具里的多段下载、断点续传也是基于它实现的，要点是：")]),t._v(" "),a("ul",[a("li",[t._v("先发个 HEAD，看服务器是否支持范围请求，同时获取文件的大小；")]),t._v(" "),a("li",[t._v("开 N 个线程，每个线程使用 Range 字段划分出各自负责下载的片段，发请求传输数据；")]),t._v(" "),a("li",[t._v("下载意外中断也不怕，不必重头再来一遍，只要根据上次的下载记录，用 Range 请求剩下的那一部分就可以了。")])]),t._v(" "),a("p",[t._v("Range针对的是原数据")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("h4",{attrs:{id:"多段数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多段数据"}},[t._v("#")]),t._v(" 多段数据")]),t._v(" "),a("p",[t._v("范围请求一次只获取一个片段，其实它还支持在 Range 头里使用多个“x-y”，一次性获取多个片段数据。")]),t._v(" "),a("p",[t._v("MIME 类型："),a("code",[t._v("multipart/byteranges")])])])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"image-20200622110844685",href:"https://raw.githubusercontent.com/SUH11/images/master/http/16-1.png"}},[a("img",{attrs:{src:"https://raw.githubusercontent.com/SUH11/images/master/http/16-1.png",alt:"image-20200622110844685"}})])]),t._v(" "),a("p",[t._v("例子：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("// 请求\nGET /16-2 HTTP/1.1\nHost: www.chrono.com\nRange: bytes=0-9, 20-29\n\n// 响应\nHTTP/1.1 206 Partial Content\nContent-Type: multipart/byteranges; boundary=00000000001\nContent-Length: 189\nConnection: keep-alive\nAccept-Ranges: bytes\n\n--00000000001\nContent-Type: text/plain\nContent-Range: bytes 0-9/96\n\n// this is\n--00000000001\nContent-Type: text/plain\nContent-Range: bytes 20-29/96\n\next json d\n--00000000001--\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("要注意这四种方法不是互斥的，而是可以混合起来使用")]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("ol",[a("li",[t._v("压缩 HTML 等文本文件是传输大文件最基本的方法；")]),t._v(" "),a("li",[t._v("分块传输可以流式收发数据，节约内存和带宽，使用响应头字段“Transfer-Encoding: chunked”来表示，分块的格式是 16 进制长度头 + 数据块；")]),t._v(" "),a("li",[t._v("范围请求可以只获取部分数据，即“分块请求”，实现视频拖拽或者断点续传，使用请求头字段“Range”和响应头字段“Content-Range”，响应状态码必须是 206；")]),t._v(" "),a("li",[t._v("也可以一次请求多个范围，这时候响应报文的数据类型是“multipart/byteranges”，body 里的多个部分会用 boundary 字符串分隔。")])])])}),[],!1,null,null,null);n.default=e.exports}}]);