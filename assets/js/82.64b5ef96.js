(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{432:function(v,_,t){"use strict";t.r(_);var e=t(42),i=Object(e.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"http性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http性能优化"}},[v._v("#")]),v._v(" HTTP性能优化")]),v._v(" "),t("p",[v._v("在整个 HTTP 系统里有三个可优化的环节，分别是"),t("strong",[v._v("服务器")]),v._v("、"),t("strong",[v._v("客户端")]),v._v("和"),t("strong",[v._v("传输链路")]),v._v("（“第一公里”和“中间一公里”）。")]),v._v(" "),t("ol",[t("li",[t("p",[v._v("https的优化")]),v._v(" "),t("p",[v._v("第28讲")])]),v._v(" "),t("li",[t("p",[v._v("http服务器")]),v._v(" "),t("p",[v._v("衡量服务器性能的主要指标有三个")]),v._v(" "),t("ul",[t("li",[v._v("吞吐量\n"),t("ul",[t("li",[v._v("RPS，每秒的请求次数："),t("strong",[v._v("RPS 越高就说明服务器的性能越好")])]),v._v(" "),t("li",[v._v("TPS")]),v._v(" "),t("li",[v._v("QPS")])])]),v._v(" "),t("li",[v._v("并发数\n"),t("ul",[t("li",[v._v("反映的是服务器的负载能力，也就是服务器能够同时支持的客户端数量")])])]),v._v(" "),t("li",[v._v("响应时间\n"),t("ul",[t("li",[v._v("反映的是服务器的处理能力，也就是快慢程度，响应时间越短")])])])]),v._v(" "),t("blockquote",[t("p",[v._v("CPU、内存、硬盘和网卡等系统资源的占用程度，利用率过高或者过低都可能有问题。")])])]),v._v(" "),t("li",[t("p",[v._v("HTTP 客户端")]),v._v(" "),t("p",[v._v("延迟")]),v._v(" "),t("ul",[t("li",[t("p",[v._v("“不可逾越”的障碍——光速")])]),v._v(" "),t("li",[t("p",[v._v("带宽")])]),v._v(" "),t("li",[t("p",[v._v("DNS 查询")])]),v._v(" "),t("li",[t("p",[v._v("TCP 握手")])]),v._v(" "),t("li",[t("p",[v._v("有解析 HTML、执行 JavaScript、排版渲染等等")]),v._v(" "),t("ul",[t("li",[t("p",[v._v("Chrome 点击某个 URI，在 Timing 页里会显示出一个小型的“瀑布图”")]),v._v(" "),t("p",[v._v("例子")]),v._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"",href:"https://static001.geekbang.org/resource/image/d7/a2/d77ee484b62910b8eedce0ecddb305a2.png"}},[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/d7/a2/d77ee484b62910b8eedce0ecddb305a2.png",alt:""}})])])])]),v._v(" "),t("p",[v._v("图里面的这些指标都是什么含义呢？我给你解释一下：")]),v._v(" "),t("ul",[t("li",[v._v("因为有“队头阻塞”，浏览器对每个域名最多开 6 个并发连接（HTTP/1.1），当页面里链接很多的时候就必须排队等待（"),t("strong",[v._v("Queued、Queueing")]),v._v("），这里它就等待了 1.62 秒，然后才被浏览器正式处理；")]),v._v(" "),t("li",[v._v("浏览器要预先分配资源，调度连接，花费了 11.56 毫秒（"),t("strong",[v._v("Stalled")]),v._v("）;")]),v._v(" "),t("li",[v._v("连接前必须要解析域名，这里因为有本地缓存，所以只消耗了 0.41 毫秒（"),t("strong",[v._v("DNS Lookup")]),v._v("）；")]),v._v(" "),t("li",[v._v("与网站服务器建立连接的成本很高，总共花费了 270.87 毫秒，其中有 134.89 毫秒用于 TLS 握手，那么 TCP 握手的时间就是 135.98 毫秒（"),t("strong",[v._v("Initial connection、SSL")]),v._v("）；")]),v._v(" "),t("li",[v._v("实际发送数据非常快，只用了 0.11 毫秒（"),t("strong",[v._v("Request sent")]),v._v("）；")]),v._v(" "),t("li",[v._v("之后就是等待服务器的响应，专有名词叫 TTFB（Time To First Byte），也就是“首字节响应时间”，里面包括了服务器的处理时间和网络传输时间，花了 124.2 毫秒；接收数据也是非常快的，用了 3.58 毫秒（"),t("strong",[v._v("Content Dowload")]),v._v("）。")])]),v._v(" "),t("p",[v._v("从这张图你可以看到，一次 HTTP“请求 - 响应”的过程中延迟的时间是非常惊人的，总时间 415.04 毫秒里占了差不多 99%。所以，"),t("strong",[v._v("客户端 HTTP 性能优化的关键就是：降低延迟")]),v._v("。")])])])]),v._v(" "),t("li",[t("p",[v._v("http传输链路")]),v._v(" "),t("p",[v._v("“"),t("strong",[v._v("第一公里")]),v._v("”“"),t("strong",[v._v("中间一公里")]),v._v("”和“"),t("strong",[v._v("最后一公里")]),v._v("”")]),v._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"",href:"https://static001.geekbang.org/resource/image/50/32/5011b2998d2a0c58c87e31000d551732.png"}},[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/50/32/5011b2998d2a0c58c87e31000d551732.png",alt:""}})])]),v._v(" "),t("p",[v._v("“第一公里”是指网站的出口，也就是服务器接入互联网的传输线路，它的带宽直接决定了网站对外的服务能力，也就是吞吐量等指标。")]),v._v(" "),t("p",[v._v("“中间一公里”就是由许多小网络组成的实际的互联网，其实它远不止“一公里”，而是非常非常庞大和复杂的网络，地理距离、网络互通都严重影响了传输速度。 （CDN在这里发挥了重要作用）")]),v._v(" "),t("p",[v._v("“最后一公里”是用户访问互联网的入口，对于固网用户就是光纤、网线，对于移动用户就是 WiFi、基站。以前它是客户端性能的主要瓶颈，延迟大带宽小")])])]),v._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),t("ol",[t("li",[v._v("性能优化是一个复杂的概念，在 HTTP 里可以分解为服务器性能优化、客户端性能优化和传输链路优化；")]),v._v(" "),t("li",[v._v("服务器有三个主要的性能指标：吞吐量、并发数和响应时间，此外还需要考虑资源利用率；")]),v._v(" "),t("li",[v._v("客户端的基本性能指标是延迟，影响因素有地理距离、带宽、DNS 查询、TCP 握手等；")]),v._v(" "),t("li",[v._v("从服务器到客户端的传输链路可以分为三个部分，我们能够优化的是前两个部分，也就是“第一公里”和“中间一公里”；")]),v._v(" "),t("li",[v._v("有很多工具可以测量这些指标，服务器端有 ab、top、sar 等，客户端可以使用测试网站，浏览器的开发者工具。")])]),v._v(" "),t("p",[t("strong",[v._v("性能优化2")])]),v._v(" "),t("ol",[t("li",[v._v("花钱购买硬件、软件或者服务可以直接提升网站的服务能力，其中最有价值的是 CDN；")]),v._v(" "),t("li",[v._v("不花钱也可以优化 HTTP，三个关键词是“开源”“节流”和“缓存”；")]),v._v(" "),t("li",[v._v("后端应该选用高性能的 Web 服务器，开启长连接，提升 TCP 的传输效率；")]),v._v(" "),t("li",[v._v("前端应该启用 gzip、br 压缩，减小文本、图片的体积，尽量少传不必要的头字段；")]),v._v(" "),t("li",[v._v("缓存是无论何时都不能忘记的性能优化利器，应该总使用 Etag 或 Last-modified 字段标记资源；")]),v._v(" "),t("li",[v._v("升级到 HTTP/2 能够直接获得许多方面的性能提升，但要留意一些 HTTP/1 的“反模式”。")])])])}),[],!1,null,null,null);_.default=i.exports}}]);