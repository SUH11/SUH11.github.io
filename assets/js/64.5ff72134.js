(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{412:function(v,_,a){"use strict";a.r(_);var e=a(42),t=Object(e.a)({},(function(){var v=this,_=v.$createElement,a=v._self._c||_;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",{attrs:{id:"http的缓存控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http的缓存控制"}},[v._v("#")]),v._v(" HTTP的缓存控制")]),v._v(" "),a("p",[v._v("请求 - 应答：缓存分为"),a("strong",[v._v("浏览器缓存")]),v._v("和"),a("strong",[v._v("客户端缓存")])]),v._v(" "),a("ol",[a("li",[a("h4",{attrs:{id:"服务器的缓存控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器的缓存控制"}},[v._v("#")]),v._v(" 服务器的缓存控制")]),v._v(" "),a("p",[v._v("Cache-Control：通用字段")]),v._v(" "),a("blockquote",[a("p",[v._v("Cache-Control: max-age=30")]),v._v(" "),a("p",[v._v("注意：max-age包含了在链路过程中所有节点停留的时间")])]),v._v(" "),a("ul",[a("li",[v._v("max-age")]),v._v(" "),a("li",[v._v("no-store：不允许缓存，例如秒杀页面")]),v._v(" "),a("li",[v._v("no-cache：可以缓存，但在使用之前必须要去服务器验证是否过期，是否有最新的版本；")]),v._v(" "),a("li",[v._v("must-revalidate：如果缓存不过期就可以继续使用，但过期了如果还想用就必须去服务器验证。")])]),v._v(" "),a("blockquote",[a("p",[v._v("生鲜速递来举例说明：")]),v._v(" "),a("p",[v._v("no-store：买来的西瓜不允许放进冰箱，要么立刻吃，要么立刻扔掉；")]),v._v(" "),a("p",[v._v("no-cache：可以放进冰箱，但吃之前必须问超市有没有更新鲜的，有就吃超市里的；")]),v._v(" "),a("p",[v._v("must-revalidate：可以放进冰箱，保鲜期内可以吃，过期了就要问超市让不让吃。")])])]),v._v(" "),a("li",[a("h4",{attrs:{id:"客户端的缓存控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端的缓存控制"}},[v._v("#")]),v._v(" 客户端的缓存控制")]),v._v(" "),a("p",[v._v("Cache-Control")]),v._v(" "),a("blockquote",[a("p",[v._v("Cache-Control：max-age=0 = Cache-Control: no-cache")])])]),v._v(" "),a("li",[a("h4",{attrs:{id:"条件请求if"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件请求if"}},[v._v("#")]),v._v(" 条件请求if")]),v._v(" "),a("p",[v._v("条件请求一共有 5 个头字段：")]),v._v(" "),a("ul",[a("li",[v._v("If-Modified-Since")]),v._v(" "),a("li",[v._v("If-None-Match")]),v._v(" "),a("li",[v._v("If-Unmodified-Since")]),v._v(" "),a("li",[v._v("If-Match")]),v._v(" "),a("li",[v._v("If-Range")])]),v._v(" "),a("p",[v._v("先了解下，If-Modified-Since / If-None-Match。")]),v._v(" "),a("p",[v._v("第一次的响应报文预先提供：Last-modified 和 ETag")]),v._v(" "),a("p",[v._v("第二次请求时，带上缓存值，验证资源是否最新。")]),v._v(" "),a("p",[v._v("如果没有变，返回304 -  Not Modified，浏览器更新有效期，然后使用缓存。")]),v._v(" "),a("blockquote",[a("p",[v._v("ETag：是资源的一个唯一标识")]),v._v(" "),a("p",[v._v("ETag 还有“强”“弱”之分。")]),v._v(" "),a("ol",[a("li",[v._v("强 ETag 要求资源在字节级别必须完全相符")]),v._v(" "),a("li",[v._v("弱 ETag 在值前有个“W/”标记，只要求资源在语义上没有变化，但内部可能会有部分发生了改变")])]),v._v(" "),a("p",[v._v("生鲜例子：")]),v._v(" "),a("p",[v._v("你打电话给超市，“我这个西瓜是 3 天前买的，还有最新的吗？”。超市看了一下库存，说：“没有啊，我这里都是 3 天前的。”于是你就知道了，再让超市送货也没用，还是吃冰箱里的西瓜吧。这就是“"),a("code",[v._v("if-Modified-Since")]),v._v("”和“"),a("code",[v._v("Last-modified")]),v._v("”。")]),v._v(" "),a("p",[v._v("但你还是想要最新的，就又打电话：“有不是沙瓤的西瓜吗？”，超市告诉你都是沙瓤的（Match），于是你还是只能吃冰箱里的沙瓤西瓜。这就是“"),a("code",[v._v("If-None-Match")]),v._v("”和“"),a("code",[v._v("弱 ETag")]),v._v("”。")]),v._v(" "),a("p",[v._v("第三次打电话，你说“有不是 8 斤的沙瓤西瓜吗？”，这回超市给了你满意的答复：“有个 10 斤的沙瓤西瓜”。于是，你就扔掉了冰箱里的存货，让超市重新送了一个新的大西瓜。这就是“"),a("code",[v._v("If-None-Match")]),v._v("”和“"),a("code",[v._v("强 ETag")]),v._v("”。")]),v._v(" "),a("p",[v._v("总结：")]),v._v(" "),a("ol",[a("li",[v._v("If-Modified-Since + Last-modified")]),v._v(" "),a("li",[v._v("If-None-Match + 弱ETag")]),v._v(" "),a("li",[v._v("If-None-Match + 强ETag")])])])])]),v._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),a("ol",[a("li",[v._v("缓存是优化系统性能的重要手段，HTTP 传输的每一个环节中都可以有缓存；")]),v._v(" "),a("li",[v._v("服务器使用“Cache-Control”设置缓存策略，常用的是“max-age”，表示资源的有效期；")]),v._v(" "),a("li",[v._v("浏览器收到数据就会存入缓存，如果没过期就可以直接使用，过期就要去服务器验证是否仍然可用；")]),v._v(" "),a("li",[v._v("验证资源是否失效需要使用“条件请求”，常用的是“if-Modified-Since”和“If-None-Match”，收到 304 就可以复用缓存里的资源；")]),v._v(" "),a("li",[v._v("验证资源是否被修改的条件有两个：“Last-modified”和“ETag”，需要服务器预先在响应报文里设置，搭配条件请求使用；")]),v._v(" "),a("li",[v._v("浏览器也可以发送“Cache-Control”字段，使用“max-age=0”或“no-cache”刷新数据。")])])])}),[],!1,null,null,null);_.default=t.exports}}]);