(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{418:function(_,v,t){"use strict";t.r(v);var e=t(42),r=Object(e.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"tls1-3特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tls1-3特性"}},[_._v("#")]),_._v(" TLS1.3特性")]),_._v(" "),t("p",[_._v("TLS1.3 的三个主要改进目标："),t("strong",[_._v("兼容")]),_._v("、"),t("strong",[_._v("安全")]),_._v("与"),t("strong",[_._v("性能")]),_._v("。")]),_._v(" "),t("ol",[t("li",[t("h4",{attrs:{id:"最大化兼容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大化兼容"}},[_._v("#")]),_._v(" 最大化兼容")]),_._v(" "),t("p",[_._v("原因：由于 1.1、1.2 等协议已经出现了很多年，很多应用软件、中间代理（官方称为“MiddleBox”）只认老的记录协议格式，更新改造很困难，甚至是不可行（设备僵化）。")]),_._v(" "),t("p",[_._v("解决办法：保持现有的记录格式不变，通过“伪装”来实现兼容，使得 TLS1.3 看上去“像是”TLS1.2。")]),_._v(" "),t("p",[t("strong",[_._v("扩展协议")])]),_._v(" "),t("ul",[t("li",[_._v("“Hello”消息后面就必须有“"),t("code",[_._v("supported_versions")]),_._v("”扩展")])])]),_._v(" "),t("li",[t("h4",{attrs:{id:"强化安全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强化安全"}},[_._v("#")]),_._v(" 强化安全")]),_._v(" "),t("ul",[t("li",[t("p",[_._v("减肥瘦身")]),_._v(" "),t("ul",[t("li",[_._v("明确禁止在记录协议里使用压缩；")]),_._v(" "),t("li",[_._v("废除了 RC4、DES 对称加密算法；")]),_._v(" "),t("li",[_._v("废除了 ECB、CBC 等传统分组模式；")]),_._v(" "),t("li",[_._v("废除了 MD5、SHA1、SHA-224 摘要算法；")]),_._v(" "),t("li",[_._v("废除了 RSA、DH 密钥交换算法和许多命名曲线")])])]),_._v(" "),t("li",[t("p",[_._v("只保留部分")]),_._v(" "),t("ul",[t("li",[_._v("保留 AES、ChaCha20 对称加密算法；")]),_._v(" "),t("li",[_._v("分组模式只能用 AEAD 的 GCM、CCM 和 Poly1305；")]),_._v(" "),t("li",[_._v("摘要算法只能用 SHA256、SHA384；")]),_._v(" "),t("li",[_._v("密钥交换算法只有 ECDHE 和 DHE；")]),_._v(" "),t("li",[_._v("椭圆曲线也被“砍”到只剩 P-256 和 x25519 等 5 种")])])])]),_._v(" "),t("p",[_._v("好处：原来众多的算法、参数组合导致密码套件非常复杂，难以选择，而现在的 TLS1.3 里只有 5 个套件，无论是客户端还是服务器都不会再犯“选择困难症”了")])]),_._v(" "),t("li",[t("h4",{attrs:{id:"提升性能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提升性能"}},[_._v("#")]),_._v(" 提升性能")]),_._v(" "),t("ul",[t("li",[_._v("TLS1.3 压缩了以前的“Hello”协商过程")]),_._v(" "),t("li",[_._v("删除了“Key Exchange”消息")])]),_._v(" "),t("p",[_._v("由2RTT ---\x3e1RTT")]),_._v(" "),t("p",[_._v("TLS1.3:")]),_._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"TLS1.3握手",href:"https://static001.geekbang.org/resource/image/4d/b0/4d1df4d07dbb1c2500fc4ea69ecf7ab0.png"}},[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/4d/b0/4d1df4d07dbb1c2500fc4ea69ecf7ab0.png",alt:"TLS1.3握手"}})])]),_._v(" "),t("p",[_._v("TLS1.2:")]),_._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"TLS1.2握手",href:"https://static001.geekbang.org/resource/image/69/6c/69493b53f1b1d540acf886ebf021a26c.png"}},[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/69/6c/69493b53f1b1d540acf886ebf021a26c.png",alt:"TLS1.2握手"}})])])]),_._v(" "),t("li",[t("h4",{attrs:{id:"握手分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#握手分析"}},[_._v("#")]),_._v(" 握手分析")]),_._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"TLS1.3",href:"https://static001.geekbang.org/resource/image/7a/db/7a2bc39fdbb421cf72a01e887e9156db.png"}},[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/7a/db/7a2bc39fdbb421cf72a01e887e9156db.png",alt:"TLS1.3"}})])]),_._v(" "),t("p",[_._v("----------1----------\x3e")]),_._v(" "),t("p",[_._v("1.Client Hello")]),_._v(" "),t("ul",[t("li",[_._v("TLS Version")]),_._v(" "),t("li",[_._v("Client Random（随机数）")]),_._v(" "),t("li",[_._v("Cipher Suites(密码套件)")]),_._v(" "),t("li",[t("strong",[_._v("supperoted_versions")])]),_._v(" "),t("li",[t("strong",[_._v("supported_groups")])]),_._v(" "),t("li",[t("strong",[_._v("signature_algorithms")])]),_._v(" "),t("li",[t("strong",[_._v("key_share")])]),_._v(" "),t("li",[t("strong",[_._v("pre_shared_key")])]),_._v(" "),t("li",[t("strong",[_._v("early_data")]),_._v(" "),t("ul",[t("li",[_._v("可以直接发送数据")])])])]),_._v(" "),t("p",[_._v("<----------2----------")]),_._v(" "),t("p",[_._v("2.Server Hello")]),_._v(" "),t("ul",[t("li",[_._v("TLS Version")]),_._v(" "),t("li",[_._v("Server Random")]),_._v(" "),t("li",[_._v("Cipher Suite(ECDHE)")]),_._v(" "),t("li",[_._v("supperted_versions")]),_._v(" "),t("li",[_._v("key_share")]),_._v(" "),t("li",[_._v("ChangeCipherSpec\n"),t("ul",[t("li",[_._v("在算出主密钥后，服务器立刻发出“Change Cipher Spec”消息，比 TLS1.2 提早进入加密通信")])])]),_._v(" "),t("li",[_._v("Encrypted Extensions")]),_._v(" "),t("li",[_._v("Certificate")]),_._v(" "),t("li",[_._v("Certificate Verify\n"),t("ul",[t("li",[_._v("用服务器的私钥把前面的曲线、套件、参数等握手数据加了签名")])])]),_._v(" "),t("li",[_._v("Finished")])]),_._v(" "),t("p",[_._v("这时只交换了两条消息，客户端和服务器就拿到了四个共享信息："),t("strong",[_._v("Client Random")]),_._v(" 和 "),t("strong",[_._v("Server Random")]),_._v("、"),t("strong",[_._v("Client Params")]),_._v(" 和 "),t("strong",[_._v("Server Params")]),_._v("，两边就可以各自用 ECDHE 算出“"),t("strong",[_._v("Pre-Master")]),_._v("”，再用 HKDF 生成主密钥“"),t("strong",[_._v("Master Secret")]),_._v("”")]),_._v(" "),t("p",[_._v("----------3----------\x3e")]),_._v(" "),t("p",[_._v("2.ChangeCipherSpec、Finished")])])]),_._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),t("ol",[t("li",[_._v("为了兼容 1.1、1.2 等“老”协议，TLS1.3 会“"),t("strong",[_._v("伪装")]),_._v("”成 TLS1.2，新特性在“扩展”("),t("strong",[_._v("supported_versions")]),_._v(")里实现；")]),_._v(" "),t("li",[_._v("1.1、1.2 在实践中发现了很多安全隐患，所以 TLS1.3 大幅度删减了加密算法，只保留了 "),t("strong",[_._v("ECDHE")]),_._v("、"),t("strong",[_._v("AES")]),_._v("、"),t("strong",[_._v("ChaCha20")]),_._v("、"),t("strong",[_._v("SHA-2")]),_._v(" 等极少数算法，强化了安全；")]),_._v(" "),t("li",[_._v("TLS1.3 也简化了握手过程，完全握手只需要一个消息往返"),t("strong",[_._v("1RTT")]),_._v("，提升了性能。")])])])}),[],!1,null,null,null);v.default=r.exports}}]);