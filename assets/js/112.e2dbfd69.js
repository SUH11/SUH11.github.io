(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{461:function(s,t,a){"use strict";a.r(t);var n=a(42),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"垃圾回收机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收机制"}},[s._v("#")]),s._v(" 垃圾回收机制")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("基本思路")]),s._v(" "),a("p",[s._v("确定哪个变量不会再使用了，然后释放它的内存。")]),s._v(" "),a("blockquote",[a("p",[s._v("这个过程是周期性的：")]),s._v(" "),a("p",[s._v("​\t垃圾回收程序每隔一段时间，就会自动执行。")])])]),s._v(" "),a("li",[a("p",[s._v("有哪些机制")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("标记清理（最常用）")]),s._v(" "),a("p",[s._v("当变量进入上下文，比如在函数内部声明一个变量时，这个变量就会被加上存在上下文中的标记。当变量离开上下文时，也会被加上离开上下文的标记。随后垃圾回收程序做一次内测清理，销毁带标记的所有值，并回收它们的内存。")])]),s._v(" "),a("li",[a("p",[s._v("引用计数")]),s._v(" "),a("p",[s._v("思路：对每个值都记录它被引用的次数。")]),s._v(" "),a("blockquote",[a("p",[s._v("声明变量并给它赋一个饮用值时，这个值引用数为1。")]),s._v(" "),a("p",[s._v("如果同一个值又被赋给另一个变量，那么引用数加1。")]),s._v(" "),a("p",[s._v("如果该值被另一个值覆盖了，那么引用数减1。")])]),s._v(" "),a("p",[s._v("问题：循环引用")]),s._v(" "),a("blockquote",[a("p",[s._v("对象A有一个指针指向对象B，而对象B也引用了对象A：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("problem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" objectA "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" objectB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  objectA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("something "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" objectB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 引用数为2")]),s._v("\n  objectB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("otherthing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" objectA  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 引用数为2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解决办法：用完了 赋值为null")]),s._v("\nobjectA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("something "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("\nobjectB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("otherthing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("解决办法：赋值null")])])])])]),s._v(" "),a("li",[a("p",[s._v("内存管理")]),s._v(" "),a("p",[s._v("解除引用：如果数据不在必要，那么把他设置为null，从而释放其引用。")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("通过const、let声明来提升性能")]),s._v(" "),a("p",[s._v("const、let都以块为作用域，所以相比var，使用这两个新关键字可能会更早的让垃圾回收程序介入，尽早回收因该回收的内存。")])]),s._v(" "),a("li",[a("p",[s._v("隐藏类和删除操作")]),s._v(" "),a("p",[s._v("所有属性相同，共享隐藏类；否则会补充新的隐藏类。")]),s._v(" "),a("blockquote",[a("p",[s._v("delete关键字会导致生成相同的隐藏类片段。")]),s._v(" "),a("p",[s._v("最佳：把不必要的属性设置为null")])])]),s._v(" "),a("li",[a("p",[s._v("内存泄漏")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("没有使用任何关键字声明变量（放在window上，window不销毁，该属性就不销毁）")])]),s._v(" "),a("li",[a("p",[s._v("定时器")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myname'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只要定时器一直运行，回调函数的引用name就会一直占有内存")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("闭包")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("outer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myname'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 这会导致分配给name的内存被泄漏。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 只要outer函数存在，就不能清理name，因为闭包一直引用着它。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("静态分配和对象池（红宝石-P99）")])]),s._v(" "),a("p",[s._v("不要动态创建矢量对象。")])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);